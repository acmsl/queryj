<?xml version="1.0"?>

<!DOCTYPE sql-list
[
  <!ELEMENT sql-list (sql+,parameter-list,result-list,property-list,flag-list)>
  <!ELEMENT sql (value,parameter-ref,result-ref?,connection-flags-ref?,statement-flags-ref?,resultset-flags-ref?)>
  <!ATTLIST sql
    id ID #REQUIRED
    dao CDATA #REQUIRED
    name CDATA #REQUIRED
    type (select | insert | update | delete | select-for-update) #REQUIRED
    implementation (mysql | oracle | postgres | odbc | all-jdbc | mock | xml | all) #REQUIRED>
  <!ELEMENT value (#PCDATA)>
  <!ELEMENT parameter-ref EMPTY>
  <!ATTLIST parameter-ref
    id IDREF #REQUIRED>
  <!ELEMENT result-ref EMPTY>
  <!ATTLIST result-ref
    id IDREF #REQUIRED>
  <!ELEMENT connection-flags-ref EMPTY>
  <!ATTLIST connection-flags-ref
    id IDREF #REQUIRED>
  <!ELEMENT statement-flags-ref EMPTY>
  <!ATTLIST statement-flags-ref
    id IDREF #REQUIRED>
  <!ELEMENT resultset-flags-ref EMPTY>
  <!ATTLIST resultset-flags-ref
    id IDREF #REQUIRED>
  <!ELEMENT parameter-list (parameter)*>
  <!ELEMENT parameter EMPTY>
  <!ATTLIST parameter
    id ID #REQUIRED
    index CDATA #REQUIRED
    type  CDATA #REQUIRED
    name  CDATA #REQUIRED>
  <!ELEMENT result-list (result)*>
  <!ELEMENT result (property-ref)+>
  <!ATTLIST result
    id ID #REQUIRED
    class CDATA #IMPLIED
    matches (single | multiple) #REQUIRED>
  <!ELEMENT property-ref EMPTY>
  <!ATTLIST property-ref
    id IDREF #REQUIRED>
  <!ELEMENT property-list (property)*>
  <!ELEMENT property EMPTY>
  <!ATTLIST property
    id ID #REQUIRED
    column_name CDATA #IMPLIED
    index CDATA #IMPLIED
    name CDATA #IMPLIED
    type CDATA #REQUIRED>
  <!ELEMENT flag-list (connection-flags*,statement-flags*,resultset-flags*)>
  <!ELEMENT connection-flags EMPTY>
  <!ATTLIST connection-flags
    id ID #REQUIRED
    transactionisolation (  TRANSACTION_NONE
                          | TRANSACTION_READ_COMMITTED
                          | TRANSACTION_READ_UNCOMMITTED
                          | TRANSACTION_REPEATABLE_READ
                          | TRANSACTION_SERIALIZABLE ) #REQUIRED>
  <!ELEMENT statement-flags EMPTY>
  <!ATTLIST statement-flags
    id ID #REQUIRED
    autogeneratedkeys (NO_GENERATED_KEYS | RETURN_GENERATED_KEYS) #IMPLIED
    fetchsize CDATA #IMPLIED
    maxfieldsize CDATA #IMPLIED
    maxrows CDATA #IMPLIED
    querytimeout CDATA #IMPLIED
    fetchdirection (FETCH_FORWARD | FETCH_REVERSE | FETCH_UNKNOWN) #IMPLIED
    escapeprocessing (true | false) #IMPLIED
    moreresults (CLOSE_CURRENT_RESULT | KEEP_CURRENT_RESULT | CLOSE_ALL_RESULTS) #IMPLIED
    cursorname CDATA #IMPLIED>
  <!ELEMENT resultset-flags EMPTY>
  <!ATTLIST resultset-flags
    id ID #REQUIRED
    type (TYPE_FORWARD_ONLY | TYPE_SCROLL_INSENSITIVE | TYPE_SCROLL_SENSITIVE) #IMPLIED
    concurrency (CONCUR_READ_ONLY | CONCUR_UPDATABLE) #IMPLIED
    holdability (HOLD_CURSORS_OVER_COMMIT | CLOSE_CURSORS_AT_COMMIT) #IMPLIED>
]>

<sql-list>
  <sql
    id="find-customer-by-customer-id-result"
    dao="customer"
    name="find-customer-by-customer-id"
    type="select"
    implementation="all">
    <value>select * from customers where customer_id = ?</value>
    <parameter-ref id="long-parameter-1"/>
    <result-ref id="find-customer-by-customer-id.result"/>
  </sql>
  <sql
    name="find-customer-by-person-last-name"
    dao="customer"
    type="select"
    implementation="all">
    <value>select c.customer_id, p.name from customers c, people p where p.last_name like ?</value>
    <parameter-ref id="long-parameter-1"/>
    <result-ref id="find-customer-by-person-last-name.result"/>
  </sql>
  <sql
    name="insert-test"
    dao="customer"
    type="insert"
    implementation="all">
    <value>insert into customers (customer_id, name) values (?, "test")</value>
    <parameter-ref id="long-parameter-1"/>
  </sql>
  <sql
    id="find-customer-for-update"
    dao="customer"
    name="find-customer-for-update"
    type="select-for-update"
    implementation="all">
    <value>select * from customers where customer_id = ? for update</value>
    <parameter-ref id="long-parameter-1"/>
    <result-ref id="find-customer-for-update.result"/>
    <connection-flags-ref id="connection-flag-transaction-serializable"/>
    <statement-flags-ref id="find-customer-for-update-statement-flags"/>
    <resultset-flags-ref id="find-customer-for-update-resultset-flags"/>
  </sql>

  <!-- SQL parameter metadata -->
  <parameter-list>
    <parameter
      id="long-parameter-1"
      index="1"
      type="long"
      name="id"/>
  </parameter-list>

  <!-- Result metadata -->
  <result-list>
    <result
      id="find-customer-by-customer-id.result"
      class="com.foo.bar.dao.CustomerValueObject"
      matches="single">
      <property-ref
        id="find-customer-by-customer-id.customer_id.property"/>
      <property-ref
        id="find-customer-by-customer-id.name.property"/>
    </result>
    <result
      id="find-customer-by-person-last-name.result"
      class="com.foo.bar.dao.CustomerValueObject"
      matches="multiple">
      <property-ref
        id="find-customer-by-person.customer_id.property"/>
      <property-ref
        id="find-customer-by-person.personName.property"/>
    </result>
    <result
      id="find-customer-for-update.result"
      class="com.foo.bar.dao.CustomerValueObject"
      matches="single">
      <property-ref
        id="find-customer-for-update.customer_id.property"/>
      <property-ref
        id="find-customer-for-update.name.property"/>
    </result>
  </result-list>

  <!-- Result property metadata -->
  <property-list>
    <property
      id="find-customer-by-customer-id.customer_id.property"
      column_name="customer_id"
      type="long"/>
    <property
      id="find-customer-by-customer-id.name.property"
      column_name="name"
      type="String"/>
    <property
      id="find-customer-by-person.customer_id.property"
      column_name="c.customer_id"
      name="customerId"
      type="long"/>
    <property
      id="find-customer-by-person.personName.property"
      column_name="p.name"
      name="personName"
      type="String"/>
    <property
      id="find-customer-for-update.customer_id.property"
      column_name="customer_id"
      type="long"/>
    <property
      id="find-customer-for-update.name.property"
      column_name="name"
      type="String"/>
  </property-list>

  <flag-list>
    <connection-flags
      id="connection-flags.find-by-primary-key"
      transactionisolation="TRANSACTION_READ_COMMITTED"/>
    <connection-flags
      id="connection-flags.default"
      transactionisolation="TRANSACTION_NONE"/>
    <connection-flags
      id="connection-flag-transaction-none"
      transactionisolation="TRANSACTION_NONE"/>
    <connection-flags
      id="connection-flag-transaction-read-committed"
      transactionisolation="TRANSACTION_READ_COMMITTED"/>
    <connection-flags
      id="connection-flag-transaction-read-uncommitted"
      transactionisolation="TRANSACTION_READ_UNCOMMITTED"/>
    <connection-flags
      id="connection-flag-transaction-repeatable-read"
      transactionisolation="TRANSACTION_REPEATABLE_READ"/>
    <connection-flags
      id="connection-flag-transaction-serializable"
      transactionisolation="TRANSACTION_TRANSACTION_SERIALIZABLE"/>
    <statement-flags
      id="statement-flags.default"
      autogeneratedkeys="NO_GENERATED_KEYS"/>
    <statement-flags
      id="find-customer-for-update-statement-flags"
      autogeneratedkeys="NO_GENERATED_KEYS"
      fetchsize="10"
      maxfieldsize="1000"
      maxrows="10"
      querytimeout="30"
      fetchdirection="FETCH_FORWARD"
      escapeprocessing="false"
      moreresults="CLOSE_ALL_RESULTS"/>
    <resultset-flags
      id="resultset-flags.default"
      type="TYPE_FORWARD_ONLY"
      concurrency="CONCUR_UPDATABLE"
      holdability="CLOSE_CURSORS_AT_COMMIT"/>
    <resultset-flags
      id="find-customer-for-update-resultset-flags"
      type="TYPE_FORWARD_ONLY"
      concurrency="CONCUR_UPDATABLE"
      holdability="CLOSE_CURSORS_AT_COMMIT"/>
  </flag-list>
</sql-list>
